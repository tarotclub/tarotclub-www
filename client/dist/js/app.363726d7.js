(function(e){function t(t){for(var i,r,o=t[0],l=t[1],c=t[2],u=0,m=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&m.push(n[r][0]),n[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);d&&d(t);while(m.length)m.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(s.splice(t--,1),e=r(r.s=a[0]))}return e}var i={},n={app:0},s=[];function r(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=i,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(a,i,function(t){return e[t]}.bind(null,i));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},4993:function(e,t,a){"use strict";var i=a("96da"),n=a.n(i);n.a},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),n=a("8c4f"),s=a("2f62"),r=a("f309"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-snackbar",{attrs:{color:e.alertType,timeout:e.alertTimeout,top:!0},model:{value:e.alertEnable,callback:function(t){e.alertEnable=t},expression:"alertEnable"}},[e._v(" "+e._s(e.alertText)+" ")]),a("TopToolbar"),a("v-content",[a("v-container",{attrs:{fluid:""}},[e.isInitialized?[a("router-view")]:[a("div",{staticClass:"text-center"},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary",size:50}})],1)]],2)],1),a("v-footer",{staticClass:"font-weight-medium",staticStyle:{"padding-top":"16px"}},[a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-bottom":"10px","padding-top":"30px"},attrs:{color:"transparent",elevation:"0"}},[a("span",[e._v("Monnaie de Paris © 2020 - Tous droits réservés")])])],1)],1)},l=[],c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-navigation-drawer",{attrs:{absolute:"",temporary:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[i("v-list-item",{staticClass:"px-2"},[i("v-list-item-avatar",[i("v-icon",[e._v("mdi-account-circle")])],1),e.isLogged?i("v-list-item-title",[e._v(e._s(e.fullName))]):e._e(),i("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}},[i("v-icon",[e._v("mdi-chevron-left")])],1)],1),i("v-divider"),i("v-list",{attrs:{dense:""}},e._l(e.menuItems,(function(t){return i("v-list-item",{key:t.title,attrs:{to:"/dashboard/"+t.page}},[i("v-list-item-icon",[i("v-icon",[e._v(e._s(t.icon))])],1),i("v-list-item-content",[i("v-list-item-title",[e._v(e._s(t.text))])],1)],1)})),1),i("v-divider"),i("v-list",{staticClass:"overflow-y-auto"},[i("div",{staticStyle:{padding:"10px",width:"100%",display:"inline-block"}},[i("v-text-field",{attrs:{label:"Recherche",solo:"",light:"",dense:"",type:"search",name:"search","append-icon":"mdi-magnify"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._l(e.machines,(function(t,a){return i("v-list-group",{key:a,attrs:{"prepend-icon":"mdi-map-marker"},scopedSlots:e._u([{key:"activator",fn:function(){return[i("v-list-item-title",[e._v(e._s(t.exploitation_site))])]},proxy:!0}],null,!0)},e._l(t.list,(function(t,a){return i("v-list-item",{key:a,attrs:{link:"",to:e.getMachineLink(t.id)}},[i("v-list-item-title",{domProps:{textContent:e._s(t.attr.machine_name)}})],1)})),1)}))],2)],1),i("v-app-bar",{attrs:{fixed:"",app:""}},[e.isLogged?i("v-app-bar-nav-icon",{on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}}):e._e(),i("router-link",{attrs:{to:"/"}},[i("img",{staticClass:"mr-3",attrs:{src:a("cf05"),height:"40"}})]),i("v-toolbar-title",[e._v(e._s(e.title))]),i("v-spacer"),e.isLogged?i("v-btn",{attrs:{to:"/dashboard/home",icon:""}},[i("v-icon",[e._v("mdi-account-circle")])],1):e._e(),e.isLogged?i("v-btn",{attrs:{icon:""},on:{click:e.logOut}},[i("v-icon",[e._v("mdi-power")])],1):e._e()],1)],1)},d=[],u=(a("4de4"),a("caad"),a("2532"),a("841c"),{data:function(){return{title:"Gestionnaire de machines",showSessionDialog:!1,drawer:null,items:[{text:"Accueil",icon:"mdi-home",page:"home",user:!0},{text:"Mon profil",icon:"mdi-account",page:"profile",user:!0},{text:"Machines",icon:"mdi-format-list-bulleted",page:"machines",user:!0},{text:"Utilisateurs",icon:"mdi-account-group",page:"users",user:!1}],search:""}},computed:{isLogged:function(){return this.$store.getters["user/isLogged"]},fullName:function(){return this.$store.getters["user/getFullName"]},isAdmin:function(){return this.$store.getters["user/isAdmin"]},machines:function(){var e=this,t=this.$store.getters["machines/machinesBySite"],a=this.search.toLowerCase();return t.filter((function(t){return""==e.search||t.exploitation_site.toLowerCase().includes(a)}))},menuItems:function(){var e=this;return this.items.filter((function(t){return t.user||e.isAdmin}))}},methods:{logOut:function(){this.$store.commit("user/LOGOUT"),this.$store.commit("machines/CLEAR_MACHINES"),this.$api.destroyToken(),this.$router.push({name:"Signin"})},getMachineLink:function(e){return"/dashboard/machineinfos/"+e}},mounted:function(){}}),m=u,p=a("2877"),v=a("6544"),h=a.n(v),f=a("40dc"),b=a("5bc1"),g=a("8336"),x=a("ce7e"),_=a("132d"),y=a("8860"),k=a("56b0"),I=a("da13"),w=a("8270"),$=a("5d23"),C=a("34c3"),S=a("f774"),V=a("2fa4"),T=a("8654"),A=a("2a7f"),M=Object(p["a"])(m,c,d,!1,null,null,null),O=M.exports;h()(M,{VAppBar:f["a"],VAppBarNavIcon:b["a"],VBtn:g["a"],VDivider:x["a"],VIcon:_["a"],VList:y["a"],VListGroup:k["a"],VListItem:I["a"],VListItemAvatar:w["a"],VListItemContent:$["a"],VListItemIcon:C["a"],VListItemTitle:$["b"],VNavigationDrawer:S["a"],VSpacer:V["a"],VTextField:T["a"],VToolbarTitle:A["a"]});var N={name:"App",components:{TopToolbar:O},data:function(){return{alertType:"error",alertText:"",alertEnable:!1,alertTimeout:3e3}},computed:{isInitialized:function(){return this.$store.state.isinitialized}},methods:{},created:function(){var e=this;this.$eventHub.$on("setAlert",(function(t,a,i){e.alertText=t,e.alertType=a,e.alertTimeout=i,e.alertEnable=!0}))},beforeDestroy:function(){this.$eventHub.$off("setAlert")}},E=N,R=a("7496"),L=a("b0af"),F=a("a523"),H=a("a75b"),P=a("553a"),z=a("490a"),j=a("2db4"),U=Object(p["a"])(E,o,l,!1,null,null,null),D=U.exports;h()(U,{VApp:R["a"],VCard:L["a"],VContainer:F["a"],VContent:H["a"],VFooter:P["a"],VProgressCircular:z["a"],VSnackbar:j["a"]});var q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-row",{attrs:{"no-gutters":""}},[a("h1",{staticClass:"title font-weight-regular pb-6"},[e._v("Mes coordonnées")])]),a("v-row",{attrs:{"no-gutters":""}},[a("v-form",{ref:"form",on:{submit:e.checkForm}},[a("v-text-field",{staticStyle:{width:"49%",display:"inline-block"},attrs:{name:"firstname",type:"firstname",label:"Prénom",outlined:"",required:""},model:{value:e.profile.firstname,callback:function(t){e.$set(e.profile,"firstname",t)},expression:"profile.firstname"}}),a("v-text-field",{staticStyle:{width:"49%",display:"inline-block",float:"right"},attrs:{name:"lastname",type:"lastname",label:"Nom",outlined:"",required:""},model:{value:e.profile.lastname,callback:function(t){e.$set(e.profile,"lastname",t)},expression:"profile.lastname"}}),a("v-text-field",{staticStyle:{width:"49%",display:"inline-block","margin-right":"2%"},attrs:{name:"tel",type:"tel",label:"Téléphone",outlined:"",required:""},model:{value:e.profile.tel,callback:function(t){e.$set(e.profile,"tel",t)},expression:"profile.tel"}}),a("v-text-field",{staticStyle:{width:"49%",display:"inline-block","margin-right":"2%"},attrs:{name:"email",type:"email",label:"E-Mail",outlined:"",required:""},model:{value:e.profile.email,callback:function(t){e.$set(e.profile,"email",t)},expression:"profile.email"}}),a("v-text-field",{staticStyle:{width:"49%",display:"inline-block"},attrs:{name:"company",type:"company",label:"Société",outlined:""},model:{value:e.profile.company,callback:function(t){e.$set(e.profile,"company",t)},expression:"profile.company"}}),a("v-btn",{staticClass:"mr-4",attrs:{color:"success",type:"submit"}},[e._v(" Sauvegarder ")])],1)],1)],1)},B=[],G={data:function(){return{profile:{firstname:"",lastname:"",company:"",email:"",tel:""}}},methods:{initialize:function(){this.profile=JSON.parse(JSON.stringify(this.$store.getters["user/getProfile"]))},checkForm:function(e){var t=this;this.$api.setMyProfile(this.profile).then((function(e){e.success?t.$api.getMyProfile().then((function(e){e.success&&(t.$store.commit("user/LOGIN_SUCCESS",e.data.profile),t.initialize(),t.$eventHub.$emit("setAlert","Vos informations ont bien été enregistrées","success",3e3))})):t.$eventHub.$emit("setAlert","Erreur lors de la sauvegarde de vos paramètres","error",3e3)})).catch((function(e){console.error(e)})),e.preventDefault()}},beforeMount:function(){this.initialize()}},J=G,Z=a("4bd4"),W=a("0fd9"),Q=Object(p["a"])(J,q,B,!1,null,null,null),K=Q.exports;h()(Q,{VBtn:g["a"],VContainer:F["a"],VForm:Z["a"],VRow:W["a"],VTextField:T["a"]});var X=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-card",[a("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialogAssignMachine,callback:function(t){e.dialogAssignMachine=t},expression:"dialogAssignMachine"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("Changer le propriétaire de la machine : "+e._s(e.editedItem.machine_name))])]),a("v-card-text",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-combobox",{attrs:{items:e.ownerItems},model:{value:e.selectedOwner,callback:function(t){e.selectedOwner=t},expression:"selectedOwner"}})],1)],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.closeAssignMachine}},[e._v("Annuler")]),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.saveAssignMachine}},[e._v("Sauver")])],1)],1)],1),a("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialogFactory,callback:function(t){e.dialogFactory=t},expression:"dialogFactory"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("Information usine de la machine : "+e._s(e.editedItem.machine_name))])]),a("v-card-text",[a("v-container",[a("v-row",{staticClass:"text-center"},[a("canvas",{ref:"qrcode",attrs:{width:"400",height:"400"}})])],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDialogFactory}},[e._v("Fermer")])],1)],1)],1),a("v-card-text",[a("v-row",{staticClass:"mx-0",attrs:{align:"center"}},[a("v-card-title",[e._v("Gestion des Machines")]),a("v-text-field",{staticStyle:{padding:"10px"},attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),a("v-divider",{staticClass:"mx-4"}),a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.machines,search:e.search},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-toolbar",{attrs:{flat:""}},[a("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"primary",dark:""}},i),[e._v("Ajouter une machine")])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.formTitle))])]),a("v-card-text",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Ville"},model:{value:e.editedItem.attr.city,callback:function(t){e.$set(e.editedItem.attr,"city",t)},expression:"editedItem.attr.city"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-combobox",{attrs:{rules:[e.rules.required],label:"Site d'exploitation",items:e.sitesList},model:{value:e.editedItem.attr.exploitation_site,callback:function(t){e.$set(e.editedItem.attr,"exploitation_site",t)},expression:"editedItem.attr.exploitation_site"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{rules:[e.rules.required],label:"Nom de la machine"},model:{value:e.editedItem.attr.machine_name,callback:function(t){e.$set(e.editedItem.attr,"machine_name",t)},expression:"editedItem.attr.machine_name"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Adresse"},model:{value:e.editedItem.attr.address,callback:function(t){e.$set(e.editedItem.attr,"address",t)},expression:"editedItem.attr.address"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Informations d'usage"},model:{value:e.editedItem.attr.usage_info,callback:function(t){e.$set(e.editedItem.attr,"usage_info",t)},expression:"editedItem.attr.usage_info"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{rules:[e.rules.required],label:"Numéro de série"},model:{value:e.editedItem.attr.serial_number,callback:function(t){e.$set(e.editedItem.attr,"serial_number",t)},expression:"editedItem.attr.serial_number"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{rules:[e.rules.gps],label:"GPS"},model:{value:e.editedItem.attr.gps,callback:function(t){e.$set(e.editedItem.attr,"gps",t)},expression:"editedItem.attr.gps"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Autres informations"},model:{value:e.editedItem.attr.misc_information,callback:function(t){e.$set(e.editedItem.attr,"misc_information",t)},expression:"editedItem.attr.misc_information"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Visuel"},model:{value:e.editedItem.attr.theme,callback:function(t){e.$set(e.editedItem.attr,"theme",t)},expression:"editedItem.attr.theme"}})],1)],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v("Annuler")]),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v("Sauver")])],1)],1)],1),a("v-spacer")],1)]},proxy:!0},{key:"item.attr.machine_name",fn:function(t){var i=t.item;return[a("a",{attrs:{href:e.getMachineLink(i.id)}},[e._v(e._s(i.attr.machine_name))])]}},{key:"item.action",fn:function(t){var i=t.item;return[a("v-icon",{staticClass:"mr-2",attrs:{medium:""},on:{click:function(t){return e.editItem(i)}}},[e._v("mdi-pencil")]),a("v-icon",{staticClass:"mr-2",attrs:{medium:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v("mdi-delete")]),a("v-icon",{staticClass:"mr-2",attrs:{medium:""},on:{click:function(t){return e.assignMachine(i)}}},[e._v("mdi-account-question")]),a("v-icon",{staticClass:"mr-2",attrs:{medium:""},on:{click:function(t){return e.showFactoryInfos(i)}}},[e._v("mdi-factory")])]}},{key:"no-data",fn:function(){return[a("v-btn",{attrs:{color:"primary"},on:{click:e.initialize}},[e._v("Refresh")])]},proxy:!0}])})],1)],1)},Y=[];a("c975"),a("d3b7"),a("25f0"),a("38cf");function ee(e){return 0===e?"Non validé":1===e?"Exploitant":2===e?"Maintenance":e>=100?"Administrateur":-1===e?"Compte désactivé":"Niveau inconnu"}var te={levelToName:ee},ae=a("d055"),ie=a.n(ae),ne={data:function(){return{dialogFactory:!1,dialogAssignMachine:!1,owners:[],selectedOwner:{},dialog:!1,search:"",headers:[{text:"Ville",value:"attr.city"},{text:"Site d'exploitation",value:"attr.exploitation_site"},{text:"Nom de la machine",value:"attr.machine_name"},{text:"Adresse",value:"attr.address"},{text:"Informations d'usage",value:"attr.usage_info"},{text:"Numéro de série",value:"attr.serial_number"},{text:"Autres informations",value:"attr.misc_information"},{text:"Visuel",value:"attr.theme"},{text:"GPS",value:"attr.gps"},{text:"Exploitant",value:"owner_id"},{text:"Actions",value:"action",sortable:!1}],editedIndex:-1,editedItem:{attr:{owner_id:0,city:"",exploitation:"",machine_name:"",address:"",usage_info:"",serial_number:"",gps:"",misc_information:"",theme:""}},defaultItem:{owner_id:0,attr:{city:"",exploitation:"",machine_name:"",address:"",usage_info:"",serial_number:"",gps:"",misc_information:"",theme:""}},rules:{required:function(e){return!!e||"Required."},gps:function(e){var t=/^((-?|\+?)?\d+(\.\d+)?),\s*((-?|\+?)?\d+(\.\d+)?)$/;return t.test(e)||"Invalid GPS coordinates."},email:function(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)||"Invalid e-mail."}}}},computed:{formTitle:function(){return-1===this.editedIndex?"Nouvelle machine":"Édition d'une machine"},isAdmin:function(){return this.$store.getters["user/isAdmin"]},machines:function(){return this.$store.state.machines.list},ownerItems:function(){for(var e=[],t=0;t<this.owners.length;t++)e.push({text:this.owners[t].username+"("+this.owners[t].company+") - "+te.levelToName(this.owners[t].level),value:this.owners[t].id});return e},sitesList:function(){for(var e=[],t=this.$store.getters["machines/machinesBySite"],a=0;a<t.length;a++)e.push(t[a].exploitation_site);return e}},watch:{dialog:function(e){e||this.close()}},created:function(){this.initialize()},methods:{getMachineLink:function(e){return"/dashboard/machineinfos/"+e},initialize:function(){var e=this;this.$api.getMachines().then((function(t){t.success?(e.$store.commit("machines/SET_MACHINES",t.data.machines),e.$api.getOwners().then((function(t){e.isAdmin&&(t.success?e.owners=t.data.owners:console.log(t.message))}))):console.log(t.message)}))},deleteItem:function(e){var t=this;confirm("Voulez-vous vraiment supprimer la machine : "+e.machine_name+" ?")&&this.$api.deleteMachine(e.id).then((function(e){e.success?(t.$eventHub.$emit("setAlert","Machine supprimée avec succès","success",3e3),t.initialize()):t.$eventHub.$emit("setAlert","Impossible de supprimer cette machine","error",3e3)}))},editItem:function(e){this.editedIndex=this.machines.indexOf(e),this.editedItem=JSON.parse(JSON.stringify(e)),this.dialog=!0},close:function(){var e=this;this.dialog=!1,setTimeout((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}),300)},save:function(){var e=this;-1==this.editedIndex?this.$api.createMachine(this.editedItem).then((function(t){t.success?(e.$eventHub.$emit("setAlert","Machine ajoutée avec succès","success",3e3),e.initialize(),e.close()):e.$eventHub.$emit("setAlert","Impossible d'ajouter cette machine, vérifez les champs","error",3e3)})):this.$api.updateMachineAttr(this.editedItem.id,this.editedItem.attr).then((function(t){t.success?(e.$eventHub.$emit("setAlert","Machine éditée avec succès","success",3e3),e.initialize(),e.close()):e.$eventHub.$emit("setAlert","Impossible d'éditer cette machine, vérifez les champs","error",3e3)}))},assignMachine:function(e){this.selectedOwner=[],this.editedIndex=this.machines.indexOf(e),this.editedItem=JSON.parse(JSON.stringify(e)),this.dialogAssignMachine=!0},closeAssignMachine:function(){this.dialogAssignMachine=!1,this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1},saveAssignMachine:function(){var e=this;isNaN(this.selectedOwner.value)||this.$api.updateMachineOwner(this.editedItem.id,this.selectedOwner.value).then((function(t){t.success?(e.$eventHub.$emit("setAlert","Propriétaire modifié avec succès","success",3e3),e.closeAssignMachine(),e.initialize()):e.$eventHub.$emit("setAlert","Impossible de modifier le propriétaire cette machine, vérifez les champs","error",3e3)}))},showFactoryInfos:function(e){var t=this;function a(e,t){var a=e.toString(16);return"0".repeat(t-a.length)+a}this.dialogFactory=!0;var i="00d5a8FFFE"+a(e.id,6),n="84aedbea55310420",s=e.attr.serial_number+";"+e.api_key+";"+i+";"+n+";"+e.app_key;this.$nextTick((function(){ie.a.toCanvas(t.$refs.qrcode,s,{errorCorrectionLevel:"H",width:400},(function(e){e&&t.$eventHub.$emit("setAlert","Erreur de génération du QrCode: "+e,"error",3e3)}))}))},closeDialogFactory:function(){this.dialogFactory=!1}}},se=ne,re=a("99d9"),oe=a("62ad"),le=a("2b5d"),ce=a("8fea"),de=a("169a"),ue=a("71d9"),me=Object(p["a"])(se,X,Y,!1,null,null,null),pe=me.exports;h()(me,{VBtn:g["a"],VCard:L["a"],VCardActions:re["a"],VCardText:re["b"],VCardTitle:re["c"],VCol:oe["a"],VCombobox:le["a"],VContainer:F["a"],VDataTable:ce["a"],VDialog:de["a"],VDivider:x["a"],VIcon:_["a"],VRow:W["a"],VSpacer:V["a"],VTextField:T["a"],VToolbar:ue["a"]});var ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[e.loaded?a("v-card",[a("v-card-title",[e._v(e._s(e.currentMachine.attr.machine_name))]),a("v-container",[a("v-row",{attrs:{justify:"space-between"}},[a("v-col",{attrs:{cols:"auto"}},[a("v-simple-table",{attrs:{dense:""}},[a("tbody",[a("tr",[a("td",[e._v("Adresse")]),a("td",[e._v(e._s(e.currentMachine.attr.address))])]),a("tr",[a("td",[e._v("Numéro de série")]),a("td",[e._v(e._s(e.currentMachine.attr.serial_number))])]),a("tr",[a("td",[e._v("Téléphone")]),a("td",[e._v("INFORMATION INCONNUE")])]),a("tr",[a("td",[e._v("Niveau de réception")]),a("td",[e._v("INFORMATION INCONNUE")])]),a("tr"),a("tr",[a("td",[e._v("GPS")]),a("td",[e._v(e._s(e.gpsText))])]),a("tr",[a("td",[e._v("Visuel")]),a("td",[e._v(e._s(e.currentMachine.attr.theme))])]),a("tr",[a("td",[e._v("Prix de vente")]),a("td",[e._v(e._s(e.medalPrice))])]),a("tr",[a("td",[e._v("Version")]),a("td",[e._v(e._s(e.firmwareVersion))])]),a("tr",[a("td",[e._v("Commentaire")]),a("td",[e._v(e._s(e.currentMachine.attr.misc_information))])])])])],1),a("v-col",{attrs:{cols:"auto"}},[a("div",{staticStyle:{width:"700px",height:"300px","padding-left":"20px",top:"0",left:"0"}},[a("l-map",{ref:"refMap",attrs:{zoom:e.zoom,center:e.center}},[a("l-tile-layer",{attrs:{url:e.url,attribution:e.attribution}}),a("l-marker",{attrs:{"lat-lng":e.marker}})],1)],1)])],1)],1),a("v-divider",{staticClass:"mx-4"}),a("v-tabs",{attrs:{centered:"",dark:"","icons-and-text":""}},[a("v-tabs-slider",{attrs:{color:"yellow"}}),a("v-tab",{attrs:{href:"#tab-1"}},[e._v(" DONNÉES "),a("v-icon",[e._v("mdi-database")])],1),a("v-tab",{attrs:{href:"#tab-2"}},[e._v(" MAINTENANCE "),a("v-icon",[e._v("mdi-wrench")])],1),a("v-tab-item",{attrs:{value:"tab-1"}},[a("v-card",{attrs:{flat:""}},[a("v-container",[a("JsonCSV",{attrs:{data:e.values_data,name:"filename.csv"}},[e._v(" Export CSV ")]),a("v-row",{staticClass:"mx-0",attrs:{align:"center"}},[a("v-text-field",{staticStyle:{padding:"10px"},attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search_data,callback:function(t){e.search_data=t},expression:"search_data"}})],1),a("v-data-table",{attrs:{headers:e.headers_data,items:e.values_data,search:e.search_data}})],1)],1)],1),a("v-tab-item",{attrs:{value:"tab-2"}},[a("v-card",{attrs:{flat:""}},[a("v-container",[a("v-row",{staticClass:"mx-0",attrs:{align:"center"}},[a("v-text-field",{staticStyle:{padding:"10px"},attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search_maintenance,callback:function(t){e.search_maintenance=t},expression:"search_maintenance"}})],1),a("v-data-table",{attrs:{headers:e.headers_maintenance,items:e.values_maintenance,search:e.search_maintenance}})],1)],1)],1)],1)],1):e._e()],1)},he=[],fe=(a("acd8"),a("1276"),a("96cf"),a("e11e")),be=a("2699"),ge=a("a40a"),xe=a("4e2b"),_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-btn",{on:{click:e.generate}},[e._t("default",[e._v(" Download "+e._s(e.name)+" ")])],2)},ye=[],ke=(a("b0c0"),a("21a6")),Ie=a("369b"),we=a.n(Ie),$e={name:"JsonCSV",props:{data:{type:Array,required:!0},fields:{required:!1},name:{type:String,default:"data.csv"},delimiter:{type:String,default:",",required:!1},separatorExcel:{type:Boolean,default:!1},encoding:{type:String,default:"utf-8"},advancedOptions:{type:Object,default:function(){}},labels:{required:!1}},methods:{generate:function(){this.$emit("export-started");var e=this.data;if(e){var t=we.a.unparse(e,Object.assign({delimiter:this.delimiter,encoding:this.encoding},this.advancedOptions));if(this.separatorExcel&&(t="SEP="+this.delimiter+"\r\n"+t),"utf-8"===this.encoding&&(t="\ufeff"+t),this.$emit("export-finished"),!this.testing){var a=new Blob([t],{type:"application/csv;charset="+this.encoding});Object(ke["saveAs"])(a,this.name)}}else console.error("No data to export")}}},Ce=$e,Se=(a("4993"),Object(p["a"])(Ce,_e,ye,!1,null,"9f507f78",null)),Ve=Se.exports;h()(Se,{VBtn:g["a"]});var Te={components:{JsonCSV:Ve,LMap:be["a"],LTileLayer:ge["a"],LMarker:xe["a"]},data:function(){return{zoom:13,loaded:!1,center:"",url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',marker:"",validMarker:!1,firmwareVersion:"INFORMATION INCONNUE",medalPrice:"INFORMATION INCONNUE",currentMachineId:-1,currentMachine:{},search_data:"",headers_data:[{text:"Date et Heure",value:"datetime"},{text:"Total médailles",value:"total"},{text:"Nb médailles depuis denier RAZ",value:"partial"},{text:"Transactions CB",value:"card_payments"},{text:"Transactions monnaie",value:"coin_payments"},{text:"Version firmware",value:"firmware_version"},{text:"Niveau médaille faible",value:"medals_level"},{text:"Prix médaille",value:"medal_price"},{text:"Transactions monnaie",value:"coin_payments"}],values_data:[],search_maintenance:"",headers_maintenance:[{text:"Date et Heure",value:"datetime"},{text:"Référence client",value:"client_ref"},{text:"Référence interne",value:"internal_ref"},{text:"État visuel",value:"visual_aspect"},{text:"Opérations effectuées",value:"operations"},{text:"Commentaires",value:"comments"}],values_maintenance:[]}},methods:{zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},check_lat_lon:function(e,t){var a=/^(-?[1-8]?\d(?:\.\d{1,18})?|90(?:\.0{1,18})?)$/,i=/^(-?(?:1[0-7]|[1-9])?\d(?:\.\d{1,18})?|180(?:\.0{1,18})?)$/,n=a.test(e),s=i.test(t);return!(!n||!s)},initialize:function(e){var t,a,i,n,s,r,o,l,c,d=this;return regeneratorRuntime.async((function(u){while(1)switch(u.prev=u.next){case 0:if(t=!1,this.validMarker=!1,this.currentMachineId=e,console.log("Machine infos for: "+this.currentMachineId),a=this.$store.state.machines.list,i=a.filter((function(e){return e.id==d.currentMachineId})),1!=i.length){u.next=26;break}return this.currentMachine=i[0],n=48.856614,s=2.3522219,r=this.currentMachine.attr.gps.split(","),2==r.length&&(n=parseFloat(r[0]),s=parseFloat(r[1]),this.check_lat_lon(n,s)&&(this.validMarker=!0)),this.marker=Object(fe["latLng"])(n,s),this.center=Object(fe["latLng"])(n,s),u.prev=14,u.next=17,regeneratorRuntime.awrap(this.$api.getData(e));case 17:o=u.sent,o.success&&(this.values_maintenance=o.data.cloud_actions,this.values_data=o.data.cloud_data,l=this.values_data.length,l>0&&(c=this.values_data[l-1],this.firmwareVersion=c.firmware_version,this.medalPrice=c.medal_price),t=!0),u.next=24;break;case 21:u.prev=21,u.t0=u["catch"](14),console.log(u.t0);case 24:u.next=27;break;case 26:t=!1;case 27:return u.abrupt("return",t);case 28:case"end":return u.stop()}}),null,this,[[14,21]])},returnToHome:function(){this.$eventHub.$emit("setAlert","Machine inconnue","error",3e3),this.$router.push({name:"Home"})}},computed:{gpsText:function(){return this.validMarker?this.currentMachine.attr.gps:"INFORMATION INCONNUE"}},beforeRouteUpdate:function(e,t,a){console.log("[MACHINE_INFO] Changed route: "+e.params.id),this.initialize(e.params.id)?a():this.returnToHome()},activated:function(){},created:function(){console.log("[MACHINE_INFO] created: "+this.$route.params.id),this.initialize(this.$route.params.id)||this.returnToHome()},mounted:function(){var e=this;this.$nextTick((function(){e.loaded=!0}))}},Ae=Te,Me=a("1f4f"),Oe=a("71a3"),Ne=a("c671"),Ee=a("fe57"),Re=a("9a96"),Le=Object(p["a"])(Ae,ve,he,!1,null,null,null),Fe=Le.exports;h()(Le,{VCard:L["a"],VCardTitle:re["c"],VCol:oe["a"],VContainer:F["a"],VDataTable:ce["a"],VDivider:x["a"],VIcon:_["a"],VRow:W["a"],VSimpleTable:Me["a"],VTab:Oe["a"],VTabItem:Ne["a"],VTabs:Ee["a"],VTabsSlider:Re["a"],VTextField:T["a"]});var He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-card",[a("v-card-text",[a("v-row",{staticClass:"mx-0",attrs:{align:"center"}},[a("v-card-title",[e._v("Gestion des utilisateurs")]),a("v-text-field",{staticStyle:{padding:"10px"},attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),a("v-divider",{staticClass:"mx-4"}),a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.users,search:e.search,"sort-by":"company",dense:""},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-toolbar",{attrs:{flat:""}},[a("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.formTitle))])]),a("v-card-text",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Prénom"},model:{value:e.editedItem.firstname,callback:function(t){e.$set(e.editedItem,"firstname",t)},expression:"editedItem.firstname"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Nom"},model:{value:e.editedItem.lastname,callback:function(t){e.$set(e.editedItem,"lastname",t)},expression:"editedItem.lastname"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Société"},model:{value:e.editedItem.company,callback:function(t){e.$set(e.editedItem,"company",t)},expression:"editedItem.company"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"E-mail"},model:{value:e.editedItem.email,callback:function(t){e.$set(e.editedItem,"email",t)},expression:"editedItem.email"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"Téléphone"},model:{value:e.editedItem.tel,callback:function(t){e.$set(e.editedItem,"tel",t)},expression:"editedItem.tel"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-select",{attrs:{items:e.levelItems,"item-text":"text","item-value":"value",label:"Niveau d'accès",dense:""},model:{value:e.editedItem.level,callback:function(t){e.$set(e.editedItem,"level",t)},expression:"editedItem.level"}})],1)],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v("Cancel")]),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v("Save")])],1)],1)],1),a("v-spacer")],1)]},proxy:!0},{key:"item.level",fn:function(t){var a=t.item;return[e._v(" "+e._s(e.getLevelName(a.level))+" ")]}},{key:"item.action",fn:function(t){var i=t.item;return[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),a("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}},{key:"no-data",fn:function(){return[a("v-btn",{attrs:{color:"primary"},on:{click:e.initialize}},[e._v("Refresh")])]},proxy:!0}])})],1)],1)},Pe=[],ze=(a("e25e"),{data:function(){return{dialog:!1,search:"",levelItems:[{text:"Nouveau compte",value:0},{text:"Exploitant",value:1},{text:"Maintenance",value:2},{text:"Administrateur",value:100}],headers:[{text:"Société",value:"company"},{text:"Nom",value:"lastname"},{text:"Prénom",value:"firstname"},{text:"Identifiant",value:"username"},{text:"E-mail",value:"email"},{text:"Téléphone",value:"tel"},{text:"Niveau",value:"level"},{text:"Actions",value:"action",sortable:!1}],users:[],editedIndex:-1,editedItem:{company:"",firstname:"",lastname:"",username:"",email:"",tel:"",level:0},defaultItem:{company:"",firstname:"",lastname:"",username:"",email:"",tel:"",level:0}}},computed:{formTitle:function(){return-1===this.editedIndex?"Nouvel utilisateur":"Édition d'un utilisateur"},isAdmin:function(){return this.$store.getters["user/isAdmin"]}},watch:{dialog:function(e){e||this.close()}},created:function(){this.initialize()},methods:{initialize:function(){var e=this;this.$api.getUsers().then((function(t){t.success?e.users=t.data.users:console.log(t.message)}))},getLevelName:function(e){for(var t="Inconnu ("+parseInt(e)+")",a=0;a<this.levelItems.length;a++)this.levelItems[a].value==e&&(t=this.levelItems[a].text);return t},editItem:function(e){this.editedIndex=this.users.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},deleteItem:function(e){var t=this;confirm("Voulez-vous vraiment supprimer l'utilisateur : "+e.username+" ?")&&this.$api.deleteUser({username:e.username}).then((function(e){e.success?(t.$eventHub.$emit("setAlert","Utilisateur supprimé avec succès","success",3e3),t.initialize()):t.$eventHub.$emit("setAlert","Impossible de supprimer cet utilisateur","error",3e3)}))},close:function(){var e=this;this.dialog=!1,setTimeout((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}),300)},save:function(){var e=this;this.editedIndex>-1&&this.$api.setUserProfile(this.editedItem).then((function(t){t.success?(e.$eventHub.$emit("setAlert","Utilisateur édité avec succès","success",3e3),e.initialize(),e.close()):e.$eventHub.$emit("setAlert","Impossible de modifier cet utilisateur, vérifez les champs","error",3e3)}))}}}),je=ze,Ue=a("b974"),De=Object(p["a"])(je,He,Pe,!1,null,null,null),qe=De.exports;h()(De,{VBtn:g["a"],VCard:L["a"],VCardActions:re["a"],VCardText:re["b"],VCardTitle:re["c"],VCol:oe["a"],VContainer:F["a"],VDataTable:ce["a"],VDialog:de["a"],VDivider:x["a"],VIcon:_["a"],VRow:W["a"],VSelect:Ue["a"],VSpacer:V["a"],VTextField:T["a"],VToolbar:ue["a"]});var Be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-bottom":"10px"},attrs:{color:"transparent",elevation:"0"}},[a("v-card-text",[a("v-row",{staticClass:"mx-0",attrs:{align:"center"}},[a("v-card-title",[e._v("Accueil")])],1)],1),a("v-container",[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"d-flex justify-center"},[a("Widget",{staticStyle:{width:"200px"},attrs:{title:e.numberOfMachines,subTitle:"Nombre de machines",icon:"mdi-slot-machine",color:"teal lighten-3"}})],1)],1)],1),a("div",{staticStyle:{width:"100%",height:"400px","text-align":"center","padding-top":"20px"}},[a("l-map",{ref:"map",staticStyle:{height:"100%",width:"100%","z-index":"0"},attrs:{zoom:e.zoom,center:e.center}},[a("l-tile-layer",{attrs:{url:e.url,attribution:e.attribution}}),e._l(e.markers,(function(t,i){return a("l-marker",{key:i,attrs:{"lat-lng":t},on:{click:function(t){return e.machineClicked(i)}}})}))],2)],1)],1)],1)},Ge=[],Je=(a("d81d"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"widget-card"},[a("v-card-text",{staticClass:"pa-0"},[a("v-container",{staticClass:"pa-0"},[a("div",{staticClass:"layout row ma-0",class:e.color},[a("div",{staticClass:"sm4 xs4 flex"},[a("div",{staticClass:"layout column ma-0 justify-center align-center"},[a("v-icon",{staticStyle:{opacity:"0.8"},attrs:{size:"50px",color:"white"}},[e._v(e._s(e.icon))])],1)]),a("div",{staticClass:"layout column ma-0 justify-center",staticStyle:{color:"white"}},[a("span",{staticClass:"caption"},[e._v(e._s(e.subTitle))]),a("div",{staticClass:"headline"},[e._v(e._s(e.title))]),a("span",{staticClass:"caption"},[e._v(e._s(e.supTitle))])])])])],1)],1)}),Ze=[],We={props:{supTitle:{type:String,required:!1},subTitle:{type:String,required:!1},title:{type:String,required:!1},icon:{type:String,required:!1},color:{type:String,required:!1}},data:function(){return{}}},Qe=We,Ke=(a("7238"),Object(p["a"])(Qe,Je,Ze,!1,null,null,null)),Xe=Ke.exports;h()(Ke,{VCard:L["a"],VCardText:re["b"],VContainer:F["a"],VIcon:_["a"]});var Ye={components:{LMap:be["a"],LTileLayer:ge["a"],LMarker:xe["a"],Widget:Xe},data:function(){return{zoom:13,center:Object(fe["latLng"])(47.41322,-1.219482),url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}},computed:{numberOfMachines:function(){return this.$store.state.machines.list.length.toString()},markers:function(){for(var e=[],t=0;t<this.numberOfMachines;t++){var a=this.$store.state.machines.list[t].attr.gps,i=a.split(",");2==i.length&&e.push(Object(fe["latLng"])(parseFloat(i[0]),parseFloat(i[1])))}return e}},mounted:function(){var e=new fe["LatLngBounds"](this.markers);this.$refs.map.fitBounds(e)},methods:{machineClicked:function(e){console.log("[MAP] clicked on machine: "+e)}}},et=Ye,tt=Object(p["a"])(et,Be,Ge,!1,null,null,null),at=tt.exports;h()(tt,{VCard:L["a"],VCardText:re["b"],VCardTitle:re["c"],VCol:oe["a"],VContainer:F["a"],VRow:W["a"]});var it=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-top":"100px","margin-bottom":"50px"},attrs:{width:"400px"}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"mx-auto",attrs:{width:"360px",elevation:"0"}},[a("h1",{staticStyle:{"padding-bottom":"10px"}},[e._v("Réinitialisation du mot de passe")]),a("p",[e._v("Entrez votre nom d'utilisateur, vous recevrez un email contenant un lien de réinitialisation.")]),a("v-card",{staticClass:"mx-auto",staticStyle:{"padding-bottom":"10px"},attrs:{elevation:"0",width:"300px"}},[a("form",{staticStyle:{"padding-bottom":"50px"},on:{submit:e.checkForm}},[a("v-text-field",{attrs:{name:"username",value:"",type:"text",label:"User name",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("v-checkbox",{attrs:{label:"Je suis un humain"},model:{value:e.checkbox,callback:function(t){e.checkbox=t},expression:"checkbox"}}),a("v-text-field",{staticStyle:{display:"none !important",visibility:"hidden !important"},attrs:{name:"email",type:"email",label:"email",autocomplete:"off"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-btn",{staticClass:"mr-4",attrs:{type:"submit"}},[e._v("Valider")]),a("v-btn",[e._v("Effacer")])],1),a("p",{staticStyle:{display:"inline"}},[e._v("Pas de compte ? ")]),a("router-link",{attrs:{to:"/sign-up"}},[a("p",{staticStyle:{display:"inline"}},[e._v("Créer un compte.")])])],1)],1)],1)],1)},nt=[],st={data:function(){return{username:"",email:"",checkbox:!1}},methods:{checkForm:function(e){var t=this;e.preventDefault(),this.checkbox&&""===this.email&&this.$api.requestResetPassword({username:this.username}).then((function(e){e.success?t.$eventHub.$emit("setAlert","Un email vous a été envoyé","success",3e3):t.$eventHub.$emit("setAlert","Impossible de vous envoyer un email","error",3e3)})).catch((function(e){console.error(e),t.$eventHub.$emit("setAlert","Impossible de vous envoyer un email","error",3e3)}))}}},rt=st,ot=a("ac7c"),lt=Object(p["a"])(rt,it,nt,!1,null,null,null),ct=lt.exports;h()(lt,{VBtn:g["a"],VCard:L["a"],VCheckbox:ot["a"],VCol:oe["a"],VTextField:T["a"]});var dt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-top":"100px","margin-bottom":"50px"},attrs:{width:"400px"}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"mx-auto",attrs:{width:"360px",elevation:"0"}},[a("h1",{staticStyle:{"padding-bottom":"10px"}},[e._v("Identification")]),a("v-card",{staticClass:"mx-auto",staticStyle:{"padding-bottom":"10px"},attrs:{elevation:"0",width:"300px"}},[a("form",{ref:"loginForm",staticStyle:{"padding-bottom":"50px"},on:{submit:e.checkForm}},[a("v-text-field",{attrs:{name:"username",value:"",type:"text",label:"User name",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("v-text-field",{staticStyle:{"padding-bottom":"20px"},attrs:{name:"password",type:"password",label:"Password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-btn",{staticClass:"mr-4",attrs:{type:"submit"}},[e._v("Valider")]),a("v-btn",{on:{click:e.reset}},[e._v("Effacer")])],1),a("p",{staticStyle:{display:"inline"}},[e._v("Mot de passe oublié ? ")]),a("router-link",{attrs:{to:"/resetpass"}},[a("p",{staticStyle:{display:"inline"}},[e._v("Réinitialisation.")])]),a("br"),a("p",{staticStyle:{display:"inline"}},[e._v("Pas de compte ? ")]),a("router-link",{attrs:{to:"/sign-up"}},[a("p",{staticStyle:{display:"inline"}},[e._v("Créer un compte.")])])],1)],1)],1)],1)},ut=[],mt={data:function(){return{username:"",password:""}},created:function(){this.$store.state.user.loggedIn&&this.returnToHome()},beforeRouteUpdate:function(e,t,a){this.$store.state.user.loggedIn?this.returnToHome():a()},methods:{returnToHome:function(){this.$router.push({name:"Home"})},reset:function(){this.password="",this.username="",this.$refs.loginForm.reset()},checkForm:function(e){var t=this;this.$api.signIn({username:this.username,password:this.password}).then((function(e){e.success?(t.$api.setToken(e.data.token),t.$api.getMachines().then((function(a){a.success&&(t.$store.commit("machines/SET_MACHINES",a.data.machines),t.$store.commit("user/LOGIN_SUCCESS",e.data.profile),t.$router.push({name:"Home"}))}))):"notvalidated"===e.reason?t.$eventHub.$emit("setAlert","Compte en attente de validation","error",3e3):t.$eventHub.$emit("setAlert","Erreur de login ou de mot de passe","error",3e3)})).catch((function(e){console.error(e)})),e.preventDefault()}}},pt=mt,vt=Object(p["a"])(pt,dt,ut,!1,null,null,null),ht=vt.exports;h()(vt,{VBtn:g["a"],VCard:L["a"],VCol:oe["a"],VTextField:T["a"]});var ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-top":"100px","margin-bottom":"50px"},attrs:{width:"400px"}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"mx-auto",attrs:{width:"360px",elevation:"0"}},[a("h1",{staticStyle:{"padding-bottom":"10px"}},[e._v("Créer un compte")]),a("v-card",{staticClass:"mx-auto",attrs:{elevation:"0",width:"300px"}},[a("form",{ref:"signupForm",staticStyle:{"padding-bottom":"30px"},on:{submit:e.checkForm}},[a("v-text-field",{attrs:{name:"username",value:"",type:"text",label:"User name",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("v-text-field",{staticStyle:{"padding-bottom":"20px"},attrs:{name:"password",type:"password",label:"Password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-text-field",{staticStyle:{display:"none !important",visibility:"hidden !important"},attrs:{name:"email",type:"email",label:"email",autocomplete:"off"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-btn",{staticClass:"mr-4",attrs:{type:"submit"}},[e._v("Valider")]),a("v-btn",{on:{click:e.reset}},[e._v("Effacer")])],1),a("router-link",{attrs:{to:"/"}},[a("p",{staticStyle:{display:"inline"}},[e._v("Revenir à l'identification.")])])],1)],1)],1)],1)},bt=[],gt={data:function(){return{password:"",username:"",email:""}},created:function(){this.$store.state.user.loggedIn&&this.returnToHome()},beforeRouteUpdate:function(e,t,a){this.$store.state.user.loggedIn?this.returnToHome():a()},methods:{returnToHome:function(){this.$eventHub.$emit("setAlert","Vous êtes déjà connecté!","error",3e3),this.$router.push({name:"Home"})},reset:function(){this.password="",this.username="",this.$refs.signupForm.reset()},checkForm:function(e){var t=this;this.$api.signup({password:this.password,username:this.username,email:this.email}).then((function(e){e.success?t.$eventHub.$emit("setAlert","Compte créé, en attente de validation","success",3e3):t.$eventHub.$emit("setAlert","Erreur lors de la création du compte","error",3e3),t.reset()})).catch((function(e){console.error(e)})),e.preventDefault()}}},xt=gt,_t=Object(p["a"])(xt,ft,bt,!1,null,null,null),yt=_t.exports;h()(_t,{VBtn:g["a"],VCard:L["a"],VCol:oe["a"],VTextField:T["a"]});var kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"mx-auto",staticStyle:{"text-align":"center","margin-top":"100px","margin-bottom":"50px"},attrs:{width:"400px"}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"mx-auto",attrs:{width:"360px",elevation:"0"}},[a("h1",{staticStyle:{"padding-bottom":"10px"}},[e._v("Réinitialiser son mot de passe")]),a("p",[e._v("Entrez votre nom d'utilisateur votre nouveau mot de passe")]),a("v-card",{staticClass:"mx-auto",attrs:{elevation:"0",width:"300px"}},[a("form",{ref:"signupForm",staticStyle:{"padding-bottom":"30px"},on:{submit:e.checkForm}},[a("v-text-field",{attrs:{name:"password",type:"password",label:"Password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-checkbox",{staticStyle:{"padding-bottom":"20px"},attrs:{label:"Je suis un humain"},model:{value:e.checkbox,callback:function(t){e.checkbox=t},expression:"checkbox"}}),a("v-text-field",{staticStyle:{display:"none !important",visibility:"hidden !important"},attrs:{name:"email",type:"email",label:"email",autocomplete:"off"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-btn",{staticClass:"mr-4",attrs:{type:"submit"}},[e._v("Valider")]),a("v-btn",{on:{click:e.reset}},[e._v("Effacer")])],1),a("router-link",{attrs:{to:"/"}},[a("p",{staticStyle:{display:"inline"}},[e._v("Revenir à l'identification.")])])],1)],1)],1)],1)},It=[],wt={data:function(){return{password:"",token:"",email:"",checkbox:!1}},created:function(){this.token=this.$route.params.token},beforeRouteUpdate:function(e){this.token=e.params.token},methods:{reset:function(){this.password="",this.username="",this.$refs.signupForm.reset()},checkForm:function(e){var t=this;e.preventDefault(),this.checkbox&&""===this.email&&this.$api.setNewPassword({password:this.password,token:this.token,honeypot:this.email,human:this.checkbox}).then((function(e){e.success?t.$eventHub.$emit("setAlert","Votre mot de passe a été modifié avec succès","success",3e3):t.$eventHub.$emit("setAlert","Impossible de modifier votre mot de passe","error",3e3),t.reset()})).catch((function(e){console.error(e)}))}}},$t=wt,Ct=Object(p["a"])($t,kt,It,!1,null,null,null),St=Ct.exports;h()(Ct,{VBtn:g["a"],VCard:L["a"],VCheckbox:ot["a"],VCol:oe["a"],VTextField:T["a"]}),i["a"].use(n["a"]);var Vt=new n["a"]({mode:"history",routes:[{path:"/",name:"Signin",component:ht},{path:"/dashboard/home",name:"Home",component:at},{path:"/dashboard/profile",name:"Profile",component:K},{path:"/dashboard/machines",name:"Machines",component:pe},{path:"/dashboard/machineinfos/:id",name:"MachineInfos",component:Fe},{path:"/dashboard/users",name:"Users",component:qe},{path:"/sign-up",name:"Signup",component:yt},{path:"/resetpass",name:"ResetPassord",component:ct},{path:"/newpassword/:token",name:"NewPassword",component:St},{path:"*",redirect:"/"}]});Vt.beforeEach((function(e,t,a){try{void 0!==e.meta.minAccessLevel&&e.meta.minAccessLevel>0||a()}catch(i){console.error("Error"+i)}}));var Tt=Vt,At={namespaced:!0,state:{loggedIn:!1,profile:{}},mutations:{LOGIN_SUCCESS:function(e,t){e.loggedIn=!0,e.profile=t},LOGIN_FAILURE:function(e){e.loggedIn=!1,e.profile.level=-1},LOGOUT:function(e){e.loggedIn=!1,e.profile.level=-1}},getters:{getProfile:function(e){return e.profile},isLogged:function(e){return e.loggedIn},isAdmin:function(e){var t=!1;return void 0!==e.profile&&(t=e.profile.level>=100),t},getFullName:function(e){return void 0!==e.profile?e.profile.firstname+" "+e.profile.lastname:""}}},Mt={namespaced:!0,state:{list:[]},mutations:{SET_MACHINES:function(e,t){e.list=t},CLEAR_MACHINES:function(e){e.list=[]}},getters:{machinesBySite:function(e){for(var t=[],a=0;a<e.list.length;a++){for(var i=!1,n=0;n<t.length;n++)if(t[n].exploitation_site==e.list[a].attr.exploitation_site){t[n].list.push(e.list[a]),i=!0;break}if(!i){var s={exploitation_site:e.list[a].attr.exploitation_site,list:[e.list[a]]};t.push(s)}}return t}}};i["a"].use(s["a"]);var Ot={isinitialized:!1},Nt={SET_INITIALIZED:function(e,t){e.isinitialized=t}},Et=!1,Rt=new s["a"].Store({modules:{user:At,machines:Mt},state:Ot,mutations:Nt,strict:Et}),Lt=a("d4ec"),Ft=a("bee2"),Ht=a("bc3a"),Pt=a.n(Ht),zt=function(){function e(){Object(Lt["a"])(this,e),this.config={baseURL:this.getRESTApiUri(),timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/json"}}}return Object(Ft["a"])(e,[{key:"getRESTApiUri",value:function(){var e=this.getRootUrl()+"/api/v1";return e}},{key:"getRootUrl",value:function(){var e=window.location.protocol+"//"+window.location.hostname;return e}},{key:"loadToken",value:function(){var e=localStorage.getItem("mdp-token");this.config.headers={Authorization:"Bearer "+e}}},{key:"setToken",value:function(e){localStorage.setItem("mdp-token",e),this.loadToken()}},{key:"destroyToken",value:function(){localStorage.setItem("mdp-token",""),this.loadToken()}},{key:"signup",value:function(e){return Pt.a.post("/auth/signup",e,this.config).then(this.handleResponse)}},{key:"signIn",value:function(e){return Pt.a.post("/auth/signin",e,this.config).then(this.handleResponse)}},{key:"setNewPassword",value:function(e){return Pt.a.post("/auth/newpassword",e,this.config).then(this.handleResponse)}},{key:"requestResetPassword",value:function(e){return Pt.a.post("/auth/resetpassword",e,this.config).then(this.handleResponse)}},{key:"setMyProfile",value:function(e){return Pt.a.post("/dashboard/user/profile",e,this.config).then(this.handleResponse)}},{key:"getMyProfile",value:function(){return Pt.a.get("/dashboard/user/profile",this.config).then(this.handleResponse)}},{key:"setUserProfile",value:function(e){return Pt.a.post("/dashboard/users/profile",e,this.config).then(this.handleResponse)}},{key:"getUsers",value:function(){return Pt.a.get("/dashboard/users/users",this.config).then(this.handleResponse)}},{key:"deleteUser",value:function(e){return Pt.a.post("/dashboard/users/delete",e,this.config).then(this.handleResponse)}},{key:"getOwners",value:function(){return Pt.a.get("/machines/manage/getowners",this.config).then(this.handleResponse)}},{key:"createMachine",value:function(e){return Pt.a.post("/machines/manage/create",e,this.config).then(this.handleResponse)}},{key:"deleteMachine",value:function(e){return Pt.a.post("/machines/manage/delete",{machine_id:e},this.config).then(this.handleResponse)}},{key:"updateMachineAttr",value:function(e,t){return Pt.a.post("/machines/manage/changeattr",{machine_id:e,attr:t},this.config).then(this.handleResponse)}},{key:"updateMachineOwner",value:function(e,t){return Pt.a.post("/machines/manage/changeowner",{machine_id:e,owner_id:t},this.config).then(this.handleResponse)}},{key:"getMachines",value:function(){return Pt.a.get("/machines/my/getall",this.config).then(this.handleResponse)}},{key:"getData",value:function(e){return Pt.a.get("/machines/my/"+e,this.config).then(this.handleResponse)}},{key:"handleResponse",value:function(e){return 200===e.status?Promise.resolve(e.data):Promise.reject(e.statusText)}}]),e}();a("6cc5");delete fe["Icon"].Default.prototype._getIconUrl,fe["Icon"].Default.mergeOptions({iconRetinaUrl:a("584d"),iconUrl:a("6397"),shadowUrl:a("e2b9")}),i["a"].use(s["a"]),i["a"].use(n["a"]),i["a"].use(r["a"]);var jt={icons:{iconfont:"mdi"},theme:{dark:!0}};i["a"].config.productionTip=!1,i["a"].prototype.$api=new zt,i["a"].prototype.$eventHub=new i["a"],new i["a"]({vuetify:new r["a"](jt),router:Tt,store:Rt,render:function(e){return e(D)},beforeCreate:function(){var e=this;this.$api.loadToken(),this.$api.getMyProfile().then((function(t){t.success?(e.$store.commit("user/LOGIN_SUCCESS",t.data.profile),e.$api.getMachines().then((function(t){t.success?(e.$store.commit("machines/SET_MACHINES",t.data.machines),e.$store.commit("SET_INITIALIZED",!0)):console.log(t.message)}))):(console.log("Not logged in."),e.$store.commit("user/LOGIN_FAILURE"),e.$store.commit("SET_INITIALIZED",!0))})).catch((function(e){console.log(e)}))}}).$mount("#app")},7238:function(e,t,a){"use strict";var i=a("ba80"),n=a.n(i);n.a},"96da":function(e,t,a){},ba80:function(e,t,a){},cf05:function(e,t,a){e.exports=a.p+"img/logo.5041176d.png"}});
//# sourceMappingURL=app.363726d7.js.map